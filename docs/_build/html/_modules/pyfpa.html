
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pyfpa &#8212; pyfpa 0.0.3 documentation</title>
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>pyfpa 0.0.3 documentation</span></a></h1>
        <h2 class="heading"><span>pyfpa</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for pyfpa</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Project for Financial Planning and Analysis</span>

<span class="sd">Written by Erik Warren</span>
<span class="sd">Original Date: October 2020</span>
<span class="sd">Version Date: November 2020</span>
<span class="sd">version: 0.0.3 beta</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">load_workbook</span>


<div class="viewcode-block" id="fpa"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa">[docs]</a><span class="k">class</span> <span class="nc">fpa</span><span class="p">:</span>
    <span class="n">fpa_help</span> <span class="o">=</span> <span class="s2">&quot;pyfpa - Financial Planning and Analysis Python Project.  Python intro for FP&amp;A Professionals.&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># Repository for Chart of Accounts or other</span>
        <span class="c1"># lists to add to dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Original import data for block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Imported data block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>   <span class="c1"># Meta data for block.  Filepath, last access/mod</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># The main dataframe for all the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># Container for consolidate() result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># Container for slicing and dicing .data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># General container for functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">=</span> <span class="p">[]</span>  <span class="c1"># General container for functions</span>
        <span class="c1"># TODO: Add Resample</span>
        <span class="c1"># Index names can only be strings</span>

    <span class="n">help_import_xl</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;Import Excel or DataFrame to .block.  cols_to_index are columns for index </span><span class="se">\</span>
<span class="s1">    which can be int or list for Excel. For DataFrame, string or list of string column names.&#39;&#39;&#39;</span>

<div class="viewcode-block" id="fpa.import_xl"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.import_xl">[docs]</a>    <span class="k">def</span> <span class="nf">import_xl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">ws_name</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cols_to_index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import a table from a worksheet in a Excel File or an existing pandas DataFrame.</span>

<span class="sd">        :param fpath: path to file OR a pandas DataFrame</span>
<span class="sd">        :param ws_name: worksheet name or index such as 0 or 2</span>
<span class="sd">        :param cols_to_index: columns to put into index either a number or a list i.e. [0, 1, 2]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cols_to_index</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fpath</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">cols_to_index</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">fpath</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
                <span class="n">fpath</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">ws_name</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;TEMP_NAME_ZZ&#39;</span>
            <span class="n">all_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">cols_to_index</span> <span class="o">=</span> <span class="n">cols_to_index</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols_to_index</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">cols_to_index</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols_to_index</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>          <span class="c1">#Fix for pandas error with list cols.</span>
                <span class="k">for</span> <span class="n">item_c</span> <span class="ow">in</span> <span class="n">cols_to_index</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">all_cols</span><span class="p">[</span><span class="n">item_c</span><span class="p">],</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drop_dimension</span><span class="p">(</span><span class="s1">&#39;TEMP_NAME_ZZ&#39;</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">)</span>
        <span class="c1">#self.block.dropna(0, &quot;all&quot;, inplace=True)</span>
        <span class="c1">#self.block.dropna(1, &quot;all&quot;, inplace=True)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">data_block_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">new_index_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
            <span class="n">new_index_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
                <span class="n">data_block_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000000</span><span class="p">)</span>
                <span class="n">new_index_values</span> <span class="o">=</span> <span class="p">[[</span><span class="n">data_block_value</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">(</span>
                    <span class="n">new_index_values</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">new_index_names</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_block_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000000</span><span class="p">)</span>
                <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
                <span class="n">dfi</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Data_Block&quot;</span><span class="p">,</span> <span class="n">data_block_value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_block_no_dup</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">while</span> <span class="n">data_block_value</span> <span class="ow">in</span> <span class="n">data_block_no_dup</span><span class="p">:</span>
                <span class="n">data_block_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000000</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Data_Block&quot;</span><span class="p">,</span> <span class="n">data_block_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="c1"># Meta_df</span>
        <span class="n">meta_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">data_block_value</span><span class="p">],</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;file&quot;</span><span class="p">,</span>
                <span class="s2">&quot;last_modified&quot;</span><span class="p">,</span>
                <span class="s2">&quot;last_accessed&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;modified_by&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="n">file_stats</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;calculated block&quot;</span>
        <span class="n">meta_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_block_value</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">fpath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">file_stats</span>
        <span class="p">)</span>
        <span class="n">meta_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_block_value</span><span class="p">,</span> <span class="s2">&quot;file_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">fpath</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">file_stats</span>
        <span class="p">)</span>
        <span class="n">meta_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_block_value</span><span class="p">,</span> <span class="s2">&quot;last_modified&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">file_stats</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">meta_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_block_value</span><span class="p">,</span> <span class="s2">&quot;last_accessed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">file_stats</span><span class="o">.</span><span class="n">st_atime</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta_df</span><span class="p">)</span></div>

    <span class="n">help_import_custom_xl</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;Import Excel using custom mapping for table and dimensions.  Enter most items as lists.&#39;&#39;&#39;</span>

<div class="viewcode-block" id="fpa.import_custom_xl"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.import_custom_xl">[docs]</a>    <span class="k">def</span> <span class="nf">import_custom_xl</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">f_path</span><span class="p">,</span>
        <span class="n">ws_name</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">table_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">idx_cols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">dim_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_names_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fill_index_na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom import with mapping for data table and dimensions from Excel worksheet.</span>

<span class="sd">        :param f_path: Path to the Excel File.</span>
<span class="sd">        :param ws_name: Name or index number of the worksheet.  i.e. &#39;Accounts&#39; or 2.</span>
<span class="sd">        :param table_coords: Excel references for top left and bottom right of table.  i.e. [&#39;B7&#39;, &#39;Z20&#39;].</span>
<span class="sd">        :param idx_cols: Number of index columns to use.  0 would be the first column and 3 would mean first 3 columns.</span>
<span class="sd">        :param dim_names: New dimensions names to add.  i.e. [&#39;Department&#39;, &#39;Geography&#39;]</span>
<span class="sd">        :param dim_values: Values for new dimensions.  i.e. [&#39;Sales&#39;, &#39;North America&#39;]</span>
<span class="sd">        :param dim_names_coords: Excel references to get dimension names from the Excel.  i.e. [&#39;A3&#39;, &#39;A4&#39;].</span>
<span class="sd">        :param dim_coords: Excel references to get dimension values from the Excel.  i.e. [&#39;B3&#39;, &#39;B4&#39;].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ws_name</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">sheetnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">ws_name</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ws_name</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="n">wb</span><span class="p">[</span><span class="n">ws_name</span><span class="p">]</span>
        <span class="n">dim_names</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">dim_names</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dim_names</span>
        <span class="k">if</span> <span class="n">dim_names_coords</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dim_names_coords</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">([</span><span class="kc">None</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dim_names_coords</span><span class="p">:</span>
                <span class="n">dim_name</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="n">dim_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dim_name</span><span class="p">)</span>
        <span class="n">dim_values</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">dim_values</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">dim_values</span>
        <span class="k">if</span> <span class="n">dim_coords</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dim_coords</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">([</span><span class="kc">None</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dim_coords</span><span class="p">:</span>
                <span class="n">dim_value</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="n">dim_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dim_value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table_coords</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">table_coords</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">ws_name</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="n">idx_cols</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_range</span> <span class="o">=</span> <span class="n">ws</span><span class="p">[</span><span class="n">table_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">table_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">range_cols</span><span class="p">,</span> <span class="n">range_index</span><span class="p">,</span> <span class="n">range_values</span><span class="p">,</span> <span class="n">row_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="n">idx_name</span> <span class="o">=</span> <span class="n">data_range</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_range</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">range_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">col_width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_cols</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_range</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">range_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_range</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">for</span> <span class="n">itemx</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">range_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">itemx</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">row_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">range_values</span><span class="p">)</span> <span class="o">/</span> <span class="n">col_width</span><span class="p">)</span>
            <span class="n">col_width_start</span><span class="p">,</span> <span class="n">col_width_end</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">col_width</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">row_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="n">append_list</span> <span class="o">=</span> <span class="n">range_values</span><span class="p">[</span><span class="n">col_width_start</span><span class="p">:</span><span class="n">col_width_end</span><span class="p">]</span>
                <span class="n">row_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">append_list</span><span class="p">)</span>
                <span class="n">col_width_start</span> <span class="o">+=</span> <span class="n">col_width</span>
                <span class="n">col_width_end</span> <span class="o">+=</span> <span class="n">col_width</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">row_list</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">range_index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">range_cols</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">idx_name</span><span class="o">.</span><span class="n">value</span>
            <span class="n">idx_cols</span> <span class="o">=</span> <span class="n">idx_cols</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">idx_cols</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">idx_cols</span> <span class="o">!=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">add_idx_range</span> <span class="o">=</span> <span class="n">idx_cols</span>
                <span class="n">add_idx_range</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">add_idx_range</span><span class="p">:</span>
                    <span class="n">add_col_name</span> <span class="o">=</span> <span class="n">range_cols</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">add_col_name</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">data_block_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
            <span class="n">data_block_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000000</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="p">[</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_block_value</span>
            <span class="n">rev_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfi</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">rev_cols</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">rev_cols</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fill_index_na</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">dfi</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_block_no_dup</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">while</span> <span class="n">data_block_value</span> <span class="ow">in</span> <span class="n">data_block_no_dup</span><span class="p">:</span>
                <span class="n">data_block_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000000</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="p">[</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_block_value</span>
            <span class="n">rev_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfi</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">rev_cols</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">rev_cols</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fill_index_na</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">dfi</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dim_values</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">([</span><span class="kc">None</span><span class="p">])</span> <span class="ow">and</span> <span class="n">dim_names</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">([</span><span class="kc">None</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">(</span><span class="n">dim_names</span><span class="p">,</span> <span class="n">dim_values</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s1">&#39;block&#39;</span><span class="p">)</span>
        <span class="c1">#Add meta data</span>
        <span class="n">meta_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">data_block_value</span><span class="p">],</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                <span class="s2">&quot;file&quot;</span><span class="p">,</span>
                <span class="s2">&quot;import_time&quot;</span><span class="p">,</span>
                <span class="s2">&quot;last_modified&quot;</span><span class="p">,</span>
                <span class="s2">&quot;last_accessed&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_path&quot;</span><span class="p">,</span>
                <span class="s2">&quot;modified_by&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="n">file_stats</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">f_path</span><span class="p">)</span>
        <span class="n">meta_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_block_value</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">f_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">f_path</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">f_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">meta_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_block_value</span><span class="p">,</span> <span class="s2">&quot;file_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_path</span>
        <span class="n">meta_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_block_value</span><span class="p">,</span> <span class="s2">&quot;import_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">meta_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_block_value</span><span class="p">,</span> <span class="s2">&quot;last_modified&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span>
            <span class="n">file_stats</span><span class="o">.</span><span class="n">st_mtime</span>
        <span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
        <span class="n">meta_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_block_value</span><span class="p">,</span> <span class="s2">&quot;last_accessed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span>
            <span class="n">file_stats</span><span class="o">.</span><span class="n">st_atime</span>
        <span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meta_df</span><span class="p">)</span></div>

<div class="viewcode-block" id="fpa.import_accts_xl"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.import_accts_xl">[docs]</a>    <span class="k">def</span> <span class="nf">import_accts_xl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f_path</span><span class="p">,</span> <span class="n">ws_name</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim_name</span><span class="o">=</span><span class="s1">&#39;nval&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import a dataframe such as a chart of accounts or sales dimensions for adding to data objects.</span>

<span class="sd">        :param f_path: Path to Excel file.</span>
<span class="sd">        :param ws_name: Name or index number of the worksheet.  i.e. &#39;Accounts&#39; or 2.</span>
<span class="sd">        :param dim_name: Identifier for the group used when retrieving it.  See merge_dim_from_accts.</span>
<span class="sd">        :return: self.accounts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dim_set</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">ws_name</span><span class="p">)</span>
        <span class="n">dim_set</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>
        <span class="n">dim_set</span><span class="p">[</span><span class="s2">&quot;dim_set&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dim_name</span>
        <span class="n">dim_set</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;dim_set&quot;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dim_set</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">dim_set</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">([</span><span class="s2">&quot;dim_set&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">,</span> <span class="n">dim_set</span><span class="p">])</span></div>
        <span class="c1"># TODO: Add check to see if adding an identical df. Concat with different indices.</span>

<div class="viewcode-block" id="fpa.import_xl_sheets"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.import_xl_sheets">[docs]</a>    <span class="k">def</span> <span class="nf">import_xl_sheets</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">f_path</span><span class="p">,</span>
        <span class="n">wb_sheets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">table_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">idx_cols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">dim_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_names_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fill_index_na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Imports all the tables from worksheets within an Excel file.</span>

<span class="sd">        :param f_path: Path to the file</span>
<span class="sd">        :param wb_sheets: Worksheets to read.  Input as list i.e. [&#39;Sales&#39;, &#39;Operations&#39;]</span>
<span class="sd">        :param table_coords: Excel references for top left and bottom right of table.  i.e. [&#39;B7&#39;, &#39;Z20&#39;].</span>
<span class="sd">        :param idx_cols: Number of index columns to use.  0 would be the first column and 3 would mean first 3 columns.</span>
<span class="sd">        :param dim_names: New dimensions names to add.  i.e. [&#39;Department&#39;, &#39;Geography&#39;]</span>
<span class="sd">        :param dim_vals: Values for new dimensions.  i.e. [&#39;Sales&#39;, &#39;North America&#39;]</span>
<span class="sd">        :param dim_names_coords: Excel references to get dimension names from the Excel.  i.e. [&#39;A3&#39;, &#39;A4&#39;].</span>
<span class="sd">        :param dim_coords: Excel references to get dimension values from the Excel.  i.e. [&#39;B3&#39;, &#39;B4&#39;].</span>
<span class="sd">        :return: self.data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dim_names</span> <span class="o">=</span> <span class="n">dim_names</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names</span><span class="p">]</span>
        <span class="n">dim_vals</span> <span class="o">=</span> <span class="n">dim_vals</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_vals</span><span class="p">]</span>
        <span class="n">dim_names_coords</span> <span class="o">=</span> <span class="n">dim_names_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names_coords</span><span class="p">]</span>
        <span class="n">dim_coords</span> <span class="o">=</span> <span class="n">dim_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_coords</span><span class="p">]</span>
        <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wb_sheets</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wb_sheets</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">sheetnames</span>
        <span class="k">if</span> <span class="n">table_coords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">import_xl</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">wsheet</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">([</span><span class="s2">&quot;Work_Sheet&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">wsheet</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_block_to_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">import_custom_xl</span><span class="p">(</span>
                    <span class="n">f_path</span><span class="p">,</span>
                    <span class="n">wsheet</span><span class="p">,</span>
                    <span class="n">table_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                    <span class="n">idx_cols</span><span class="p">,</span>
                    <span class="n">dim_names</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                    <span class="n">dim_vals</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                    <span class="n">dim_names_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                    <span class="n">dim_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                    <span class="n">fill_index_na</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_block_to_data</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></div>

<div class="viewcode-block" id="fpa.import_xl_directory"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.import_xl_directory">[docs]</a>    <span class="k">def</span> <span class="nf">import_xl_directory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dir_path</span><span class="p">,</span>
        <span class="n">xl_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ws_name</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">table_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">idx_cols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">dim_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_names_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fill_index_na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Imports dimensions and table from a worksheet from all the Excel files (with or without identifiers) from a directory.</span>

<span class="sd">        :param dir_path: Path to the directory containing the files</span>
<span class="sd">        :param xl_id: String used to filter files to extract data, i.e. if file name is &quot;Budget v3.xlsx&quot; you could say &#39;v3.xlsx&#39;</span>
<span class="sd">        :param ws_name: Worksheet to read.  Input as string i.e. &#39;Sales&#39; or index.  Zero is default.</span>
<span class="sd">        :param table_coords: Excel references for top left and bottom right of table.  i.e. [&#39;B7&#39;, &#39;Z20&#39;].</span>
<span class="sd">        :param idx_cols: Number of index columns to use.  0 would be the first column and 3 would mean first 3 columns.</span>
<span class="sd">        :param dim_names: New dimensions names to add.  i.e. [&#39;Department&#39;, &#39;Geography&#39;]</span>
<span class="sd">        :param dim_vals: Values for new dimensions.  i.e. [&#39;Sales&#39;, &#39;North America&#39;]</span>
<span class="sd">        :param dim_names_coords: Excel references to get dimension names from the Excel.  i.e. [&#39;A3&#39;, &#39;A4&#39;].</span>
<span class="sd">        :param dim_coords: Excel references to get dimension values from the Excel.  i.e. [&#39;B3&#39;, &#39;B4&#39;].</span>
<span class="sd">        :return: self.data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dim_names</span> <span class="o">=</span> <span class="n">dim_names</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names</span><span class="p">]</span>
        <span class="n">dim_vals</span> <span class="o">=</span> <span class="n">dim_vals</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_vals</span><span class="p">]</span>
        <span class="n">dim_names_coords</span> <span class="o">=</span> <span class="n">dim_names_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names_coords</span><span class="p">]</span>
        <span class="n">dim_coords</span> <span class="o">=</span> <span class="n">dim_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_coords</span><span class="p">]</span>
        <span class="n">file_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xl_id</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_list</span> <span class="o">=</span> <span class="n">file_list</span><span class="p">[</span><span class="n">file_list</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">xl_id</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
            <span class="n">dir_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">f_path</span> <span class="o">=</span> <span class="n">dir_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span>
            <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># wb_sheets = wb.sheetnames</span>
            <span class="n">wb_sheets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ws_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">table_coords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">import_xl</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">wsheet</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">([</span><span class="s2">&quot;Work_Sheet&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">wsheet</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_block_to_data</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">import_custom_xl</span><span class="p">(</span>
                        <span class="n">f_path</span><span class="p">,</span>
                        <span class="n">ws_name</span><span class="p">,</span>
                        <span class="n">table_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="n">idx_cols</span><span class="p">,</span>
                        <span class="n">dim_names</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="n">dim_vals</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="n">dim_names_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="n">dim_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="n">fill_index_na</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_block_to_data</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></div>

<div class="viewcode-block" id="fpa.import_xl_directories"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.import_xl_directories">[docs]</a>    <span class="k">def</span> <span class="nf">import_xl_directories</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dir_path</span><span class="p">,</span>
        <span class="n">xl_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ws_name</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">table_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">idx_cols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">dim_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_names_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fill_index_na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Imports dimensions and table from a worksheet from all the Excel files (with or without identifiers) from a series of directories.</span>

<span class="sd">        :param dir_path: Path to the root directory containing the directories which contain the files.</span>
<span class="sd">        :param xl_id: String used to filter files to extract data, i.e. if file name is &quot;Budget v3.xlsx&quot; you could say &#39;v3.xlsx&#39;</span>
<span class="sd">        :param ws_name: Worksheet to read.  Input as string i.e. &#39;Sales&#39; or index.  Zero is default.</span>
<span class="sd">        :param table_coords: Excel references for top left and bottom right of table.  i.e. [&#39;B7&#39;, &#39;Z20&#39;].</span>
<span class="sd">        :param idx_cols: Number of index columns to use.  0 would be the first column and 3 would mean first 3 columns.</span>
<span class="sd">        :param dim_names: New dimensions names to add.  i.e. [&#39;Department&#39;, &#39;Geography&#39;]</span>
<span class="sd">        :param dim_vals: Values for new dimensions.  i.e. [&#39;Sales&#39;, &#39;North America&#39;]</span>
<span class="sd">        :param dim_names_coords: Excel references to get dimension names from the Excel.  i.e. [&#39;A3&#39;, &#39;A4&#39;].</span>
<span class="sd">        :param dim_coords: Excel references to get dimension values from the Excel.  i.e. [&#39;B3&#39;, &#39;B4&#39;].</span>
<span class="sd">        :return: self.data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dim_names</span> <span class="o">=</span> <span class="n">dim_names</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names</span><span class="p">]</span>
        <span class="n">dim_vals</span> <span class="o">=</span> <span class="n">dim_vals</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_vals</span><span class="p">]</span>
        <span class="n">dim_names_coords</span> <span class="o">=</span> <span class="n">dim_names_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names_coords</span><span class="p">]</span>
        <span class="n">dim_coords</span> <span class="o">=</span> <span class="n">dim_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_coords</span><span class="p">]</span>
        <span class="n">dir_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">))</span>
        <span class="n">dir_list</span> <span class="o">=</span> <span class="n">dir_list</span><span class="p">[</span><span class="o">~</span><span class="n">dir_list</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;\.&quot;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="n">dir_path</span> <span class="o">=</span> <span class="n">dir_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dir_list</span><span class="p">:</span>
            <span class="n">file_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">dir</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">xl_id</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_list</span> <span class="o">=</span> <span class="n">file_list</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">file_list</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">xl_id</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="o">~</span><span class="n">file_list</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                <span class="p">]</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
                <span class="n">f_path</span> <span class="o">=</span> <span class="n">dir_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span>
                <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># wb_sheets = wb.sheetnames</span>
                <span class="n">wb_sheets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ws_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">table_coords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">import_xl</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">wsheet</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">([</span><span class="s2">&quot;Work_Sheet&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">wsheet</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_block_to_data</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">import_custom_xl</span><span class="p">(</span>
                            <span class="n">f_path</span><span class="p">,</span>
                            <span class="n">ws_name</span><span class="p">,</span>
                            <span class="n">table_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                            <span class="n">idx_cols</span><span class="p">,</span>
                            <span class="n">dim_names</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                            <span class="n">dim_vals</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                            <span class="n">dim_names_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                            <span class="n">dim_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                            <span class="n">fill_index_na</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_block_to_data</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></div>

<div class="viewcode-block" id="fpa.update_custom_xl"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.update_custom_xl">[docs]</a>    <span class="k">def</span> <span class="nf">update_custom_xl</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">f_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ws_name</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">table_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">idx_cols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">dim_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_names_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom update of existing data with mapping for data and dimensions from Excel Worksheet.  It will</span>
<span class="sd">        update a section of &#39;data&#39;, which has an identical dimension structure (excluding &#39;Data_Block&#39; with new data.</span>
<span class="sd">        The new block&#39;s meta information will be referenced in the original blocks data to show history.</span>

<span class="sd">        :param f_path: Path to the Excel File.</span>
<span class="sd">        :param ws_name: Name or index number of the worksheet.  i.e. &#39;Accounts&#39; or 2.</span>
<span class="sd">        :param table_coords: Excel references for top left and bottom right of table.  i.e. [&#39;B7&#39;, &#39;Z20&#39;].</span>
<span class="sd">        :param idx_cols: Number of index columns to use.  0 would be the first column and 3 would mean first 3 columns.</span>
<span class="sd">        :param dim_names: New dimensions names to add.  i.e. [&#39;Department&#39;, &#39;Geography&#39;]</span>
<span class="sd">        :param dim_vals: Values for new dimensions.  i.e. [&#39;Sales&#39;, &#39;North America&#39;]</span>
<span class="sd">        :param dim_names_coords: Excel references to get dimension names from the Excel.  i.e. [&#39;A3&#39;, &#39;A4&#39;].</span>
<span class="sd">        :param dim_coords: Excel references to get dimension values from the Excel.  i.e. [&#39;B3&#39;, &#39;B4&#39;].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table_coords</span> <span class="o">=</span> <span class="n">table_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">table_coords</span><span class="p">]</span>
        <span class="n">dim_names</span> <span class="o">=</span> <span class="n">dim_names</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names</span><span class="p">]</span>
        <span class="n">dim_vals</span> <span class="o">=</span> <span class="n">dim_vals</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_vals</span><span class="p">]</span>
        <span class="n">dim_names_coords</span> <span class="o">=</span> <span class="n">dim_names_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names_coords</span><span class="p">]</span>
        <span class="n">dim_coords</span> <span class="o">=</span> <span class="n">dim_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_coords</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_custom_xl</span><span class="p">(</span>
            <span class="n">f_path</span><span class="p">,</span>
            <span class="n">ws_name</span><span class="p">,</span>
            <span class="n">table_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="n">idx_cols</span><span class="p">,</span>
            <span class="n">dim_names</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="n">dim_vals</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="n">dim_names_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="n">dim_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_align_indicies</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">)</span>
        <span class="n">data_nodb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
        <span class="n">block_nodb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
        <span class="n">count_iloc</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_nodb</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">itemx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">block_nodb</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">count_iloc</span><span class="p">):</span>
            <span class="n">idx_data</span> <span class="o">=</span> <span class="n">data_nodb</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">col_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                <span class="n">col_id_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_data</span><span class="p">,</span> <span class="n">col_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">itemx</span><span class="p">,</span> <span class="n">col_id_b</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># Add modified block number to modified_by in meta_block</span>
        <span class="n">idx_db</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="s2">&quot;Data_Block&quot;</span>
        <span class="p">)</span>  <span class="c1"># get the int position of DB</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_data</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
        <span class="p">):</span>
            <span class="n">data_db_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_data</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">idx_db</span><span class="p">]</span>  <span class="c1"># Series</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_db_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_data</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx_db</span><span class="p">]</span>  <span class="c1"># DF</span>
        <span class="n">block_db_no</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mod_by</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_db_no</span><span class="p">,</span> <span class="s2">&quot;modified_by&quot;</span><span class="p">])</span>
        <span class="n">mod_by</span> <span class="o">=</span> <span class="n">mod_by</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">block_db_no</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_db_no</span><span class="p">,</span> <span class="s2">&quot;modified_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod_by</span></div>
        <span class="c1"># TODO: REFINE this.</span>

<div class="viewcode-block" id="fpa.update_xl_sheets"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.update_xl_sheets">[docs]</a>    <span class="k">def</span> <span class="nf">update_xl_sheets</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">f_path</span><span class="p">,</span>
        <span class="n">wb_sheets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">table_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">idx_cols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">dim_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_names_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates all the tables from worksheets within an Excel file. It will</span>
<span class="sd">        update a section of &#39;data&#39;, which has an identical dimension structure (excluding &#39;Data_Block&#39; with new data.</span>
<span class="sd">        The new block&#39;s meta information will be referenced in the original blocks data to show history.</span>

<span class="sd">        :param f_path: Path to the file</span>
<span class="sd">        :param wb_sheets: Worksheets to read.  Input as list i.e. [&#39;Sales&#39;, &#39;Operations&#39;]</span>
<span class="sd">        :param table_coords: Excel references for top left and bottom right of table.  i.e. [&#39;B7&#39;, &#39;Z20&#39;].</span>
<span class="sd">        :param idx_cols: Number of index columns to use.  0 would be the first column and 3 would mean first 3 columns.</span>
<span class="sd">        :param dim_names: New dimensions names to add.  i.e. [&#39;Department&#39;, &#39;Geography&#39;]</span>
<span class="sd">        :param dim_vals: Values for new dimensions.  i.e. [&#39;Sales&#39;, &#39;North America&#39;]</span>
<span class="sd">        :param dim_names_coords: Excel references to get dimension names from the Excel.  i.e. [&#39;A3&#39;, &#39;A4&#39;].</span>
<span class="sd">        :param dim_coords: Excel references to get dimension values from the Excel.  i.e. [&#39;B3&#39;, &#39;B4&#39;].</span>
<span class="sd">        :return: self.data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dim_names</span> <span class="o">=</span> <span class="n">dim_names</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names</span><span class="p">]</span>
        <span class="n">dim_vals</span> <span class="o">=</span> <span class="n">dim_vals</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_vals</span><span class="p">]</span>
        <span class="n">dim_names_coords</span> <span class="o">=</span> <span class="n">dim_names_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names_coords</span><span class="p">]</span>
        <span class="n">dim_coords</span> <span class="o">=</span> <span class="n">dim_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_coords</span><span class="p">]</span>
        <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">data_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wb_sheets</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wb_sheets</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">sheetnames</span>
        <span class="k">if</span> <span class="n">table_coords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">import_xl</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">wsheet</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">([</span><span class="s2">&quot;Work_Sheet&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">wsheet</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_block_to_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_custom_xl</span><span class="p">(</span>
                    <span class="n">f_path</span><span class="p">,</span>
                    <span class="n">wsheet</span><span class="p">,</span>
                    <span class="n">table_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                    <span class="n">idx_cols</span><span class="p">,</span>
                    <span class="n">dim_names</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                    <span class="n">dim_vals</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                    <span class="n">dim_names_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                    <span class="n">dim_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></div>

<div class="viewcode-block" id="fpa.update_xl_directory"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.update_xl_directory">[docs]</a>    <span class="k">def</span> <span class="nf">update_xl_directory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dir_path</span><span class="p">,</span>
        <span class="n">xl_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ws_name</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">table_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">idx_cols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">dim_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_names_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates dimensions and table from a worksheet from all the Excel files (with or without identifiers) from a directory. It will</span>
<span class="sd">        update a section of &#39;data&#39;, which has an identical dimension structure (excluding &#39;Data_Block&#39; with new data.</span>
<span class="sd">        The new block&#39;s meta information will be referenced in the original blocks data to show history.</span>

<span class="sd">        :param dir_path: Path to the directory containing the files</span>
<span class="sd">        :param xl_id: String used to filter files to extract data, i.e. if file name is &quot;Budget v3.xlsx&quot; you could say &#39;v3.xlsx&#39;</span>
<span class="sd">        :param ws_name: Worksheet to read.  Input as string i.e. &#39;Sales&#39; or index.  Zero is default.</span>
<span class="sd">        :param table_coords: Excel references for top left and bottom right of table.  i.e. [&#39;B7&#39;, &#39;Z20&#39;].</span>
<span class="sd">        :param idx_cols: Number of index columns to use.  0 would be the first column and 3 would mean first 3 columns.</span>
<span class="sd">        :param dim_names: New dimensions names to add.  i.e. [&#39;Department&#39;, &#39;Geography&#39;]</span>
<span class="sd">        :param dim_vals: Values for new dimensions.  i.e. [&#39;Sales&#39;, &#39;North America&#39;]</span>
<span class="sd">        :param dim_names_coords: Excel references to get dimension names from the Excel.  i.e. [&#39;A3&#39;, &#39;A4&#39;].</span>
<span class="sd">        :param dim_coords: Excel references to get dimension values from the Excel.  i.e. [&#39;B3&#39;, &#39;B4&#39;].</span>
<span class="sd">        :return: self.data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dim_names</span> <span class="o">=</span> <span class="n">dim_names</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names</span><span class="p">]</span>
        <span class="n">dim_vals</span> <span class="o">=</span> <span class="n">dim_vals</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_vals</span><span class="p">]</span>
        <span class="n">dim_names_coords</span> <span class="o">=</span> <span class="n">dim_names_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names_coords</span><span class="p">]</span>
        <span class="n">dim_coords</span> <span class="o">=</span> <span class="n">dim_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_coords</span><span class="p">]</span>
        <span class="n">file_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xl_id</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_list</span> <span class="o">=</span> <span class="n">file_list</span><span class="p">[</span><span class="n">file_list</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">xl_id</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
            <span class="n">dir_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">f_path</span> <span class="o">=</span> <span class="n">dir_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span>
            <span class="n">wb_sheets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ws_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">table_coords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">import_xl</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">wsheet</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">([</span><span class="s2">&quot;Work_Sheet&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">wsheet</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_block_to_data</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_custom_xl</span><span class="p">(</span>
                        <span class="n">f_path</span><span class="p">,</span>
                        <span class="n">ws_name</span><span class="p">,</span>
                        <span class="n">table_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="n">idx_cols</span><span class="p">,</span>
                        <span class="n">dim_names</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="n">dim_vals</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="n">dim_names_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="n">dim_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></div>

<div class="viewcode-block" id="fpa.update_xl_directories"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.update_xl_directories">[docs]</a>    <span class="k">def</span> <span class="nf">update_xl_directories</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dir_path</span><span class="p">,</span>
        <span class="n">xl_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ws_name</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">table_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">idx_cols</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">dim_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_names_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_coords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Imports dimensions and table from a worksheet from all the Excel files (with or without identifiers) from a series of directories. It will</span>
<span class="sd">        update a section of &#39;data&#39;, which has an identical dimension structure (excluding &#39;Data_Block&#39; with new data.</span>
<span class="sd">        The new block&#39;s meta information will be referenced in the original blocks data to show history.</span>

<span class="sd">        :param dir_path: Path to the root directory containing the directories which contain the files.</span>
<span class="sd">        :param xl_id: String used to filter files to extract data, i.e. if file name is &quot;Budget v3.xlsx&quot; you could say &#39;v3.xlsx&#39;</span>
<span class="sd">        :param ws_name: Worksheet to read.  Input as string i.e. &#39;Sales&#39; or index.  Zero is default.</span>
<span class="sd">        :param table_coords: Excel references for top left and bottom right of table.  i.e. [&#39;B7&#39;, &#39;Z20&#39;].</span>
<span class="sd">        :param idx_cols: Number of index columns to use.  0 would be the first column and 3 would mean first 3 columns.</span>
<span class="sd">        :param dim_names: New dimensions names to add.  i.e. [&#39;Department&#39;, &#39;Geography&#39;]</span>
<span class="sd">        :param dim_vals: Values for new dimensions.  i.e. [&#39;Sales&#39;, &#39;North America&#39;]</span>
<span class="sd">        :param dim_names_coords: Excel references to get dimension names from the Excel.  i.e. [&#39;A3&#39;, &#39;A4&#39;].</span>
<span class="sd">        :param dim_coords: Excel references to get dimension values from the Excel.  i.e. [&#39;B3&#39;, &#39;B4&#39;].</span>
<span class="sd">        :return: self.data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dim_names</span> <span class="o">=</span> <span class="n">dim_names</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names</span><span class="p">]</span>
        <span class="n">dim_vals</span> <span class="o">=</span> <span class="n">dim_vals</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_vals</span><span class="p">]</span>
        <span class="n">dim_names_coords</span> <span class="o">=</span> <span class="n">dim_names_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_names_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_names_coords</span><span class="p">]</span>
        <span class="n">dim_coords</span> <span class="o">=</span> <span class="n">dim_coords</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_coords</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_coords</span><span class="p">]</span>
        <span class="n">dir_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">))</span>
        <span class="n">dir_list</span> <span class="o">=</span> <span class="n">dir_list</span><span class="p">[</span><span class="o">~</span><span class="n">dir_list</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;\.&quot;</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
        <span class="n">dir_path</span> <span class="o">=</span> <span class="n">dir_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">dir_list</span><span class="p">:</span>
            <span class="n">file_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">dir</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">xl_id</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">file_list</span> <span class="o">=</span> <span class="n">file_list</span><span class="p">[</span>
                    <span class="n">file_list</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">xl_id</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
                <span class="n">f_path</span> <span class="o">=</span> <span class="n">dir_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span>
                <span class="n">wb_sheets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ws_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">table_coords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">import_xl</span><span class="p">(</span><span class="n">f_path</span><span class="p">,</span> <span class="n">wsheet</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">([</span><span class="s2">&quot;Work_Sheet&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">wsheet</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_block_to_data</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">wsheet</span> <span class="ow">in</span> <span class="n">wb_sheets</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">update_custom_xl</span><span class="p">(</span>
                            <span class="n">f_path</span><span class="p">,</span>
                            <span class="n">ws_name</span><span class="p">,</span>
                            <span class="n">table_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                            <span class="n">idx_cols</span><span class="p">,</span>
                            <span class="n">dim_names</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                            <span class="n">dim_vals</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                            <span class="n">dim_names_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                            <span class="n">dim_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></div>

<div class="viewcode-block" id="fpa.add_block_to_data"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.add_block_to_data">[docs]</a>    <span class="k">def</span> <span class="nf">add_block_to_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Takes the block data object, arranges the index and adds it to the data object.  Even if the indexes don&#39;t</span>
<span class="sd">        match, this will fill in the missing pieces.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">!=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_align_indicies</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">])</span></div>

    <span class="n">help_add_dimensions</span> <span class="o">=</span> <span class="s2">&quot;Add dimensions and values with lists [&#39;???&#39;,...]&quot;</span>

<div class="viewcode-block" id="fpa.add_dimensions"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.add_dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">add_dimensions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">new_dimensions</span><span class="p">,</span> <span class="n">dim_values_to_add</span><span class="p">,</span> <span class="n">col_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append a dimension to the index with a new name, values and where to place it.</span>

<span class="sd">        :param new_dimensions: Name of the new dimension or dimensions.  String value or list i.e. &#39;Department&#39; or</span>
<span class="sd">         [&#39;Department&#39;, &#39;Region&#39;]</span>
<span class="sd">        :param dim_values_to_add: Values of the new dimension or dimensions.  String value or list i.e. &#39;Sales&#39; or</span>
<span class="sd">         [&#39;Sales&#39;, &#39;EMEA&#39;]</span>
<span class="sd">        :param col_num: Where in the index to place the new dimension.  1 indicates 1 column from the left.</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;block&#39;, &#39;slice&#39;, &#39;consolidation&#39;, &#39;function_result&#39;, &#39;data&#39;</span>
<span class="sd">        :return: data_obj</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_dimensions</span> <span class="o">=</span> <span class="n">new_dimensions</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_dimensions</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">new_dimensions</span><span class="p">]</span>
        <span class="n">dim_values_to_add</span> <span class="o">=</span> <span class="n">dim_values_to_add</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_values_to_add</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_values_to_add</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_dimensions</span><span class="p">,</span> <span class="n">dim_values_to_add</span><span class="p">):</span>
                <span class="n">dfi</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">col_num</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_dimensions</span><span class="p">,</span> <span class="n">dim_values_to_add</span><span class="p">):</span>
                <span class="n">dfi</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">col_num</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_dimensions</span><span class="p">,</span> <span class="n">dim_values_to_add</span><span class="p">):</span>
                <span class="n">dfi</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">col_num</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;function_result&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_dimensions</span><span class="p">,</span> <span class="n">dim_values_to_add</span><span class="p">):</span>
                <span class="n">dfi</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">col_num</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">new_dimensions</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dim_values_to_add</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_values_to_add</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
            <span class="p">):</span>
                <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_dimensions</span><span class="p">,</span> <span class="n">dim_values_to_add</span><span class="p">):</span>
                    <span class="n">dfi</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">col_num</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
                <span class="n">index_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">_count_level</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">index_counts</span> <span class="o">=</span> <span class="n">index_counts</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
                    <span class="n">dfi</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">new_dim_name</span> <span class="ow">in</span> <span class="n">new_dimensions</span><span class="p">:</span>
                    <span class="n">dim_value_index</span> <span class="o">=</span> <span class="n">new_dimensions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">new_dim_name</span><span class="p">)</span>
                    <span class="n">dim_value_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">dim_value_loop</span> <span class="o">=</span> <span class="n">dim_values_to_add</span><span class="p">[</span><span class="n">dim_value_index</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">idx_value</span> <span class="ow">in</span> <span class="n">index_counts</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">dim_value</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">dim_value_loop</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dim_value_loop</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                            <span class="k">else</span> <span class="n">dim_value_loop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">number_of_iter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_value</span><span class="p">]))</span>
                        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">number_of_iter</span><span class="p">:</span>
                            <span class="n">dim_value_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dim_value</span><span class="p">)</span>
                    <span class="n">dim_value_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dim_value_list</span><span class="p">)</span>
                    <span class="n">dim_value_list</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_dim_name</span>
                    <span class="n">dfi</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_dim_name</span><span class="p">,</span> <span class="n">dim_value_list</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span></div>

            <span class="c1"># TODO: FIX add dimension to data for multiple. work on ordering when adding</span>

    <span class="n">help_merge_dim_from_accts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;One-to-One add of a dimension from an accounts based on existing dimension&quot;</span>
    <span class="p">)</span>

<div class="viewcode-block" id="fpa.merge_dim_from_accts"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.merge_dim_from_accts">[docs]</a>    <span class="k">def</span> <span class="nf">merge_dim_from_accts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim_set</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">new_dims</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add dimension based on account data object. If you have a chart of accounts you could add the account number</span>
<span class="sd">        to the Line Item if you have it.</span>

<span class="sd">        :param dim_set: Section of &#39;accounts&#39; data object to take new dimensions.</span>
<span class="sd">        :param base_dim: Existing dimension in the index on which to merge the new dimension</span>
<span class="sd">        :param new_dims: Column from the accounts data object table to add to the dataframe</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;</span>
<span class="sd">        :return: data_object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dim_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dim_set</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">dim_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">new_dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_dims</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_dims</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">new_dims</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;function_result&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span></div>

    <span class="n">help_merge_dim_from_xl</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;One-to-One add of a dimension from an excel list based on existing dimension&quot;</span>
    <span class="p">)</span>

<div class="viewcode-block" id="fpa.merge_dim_from_xl"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.merge_dim_from_xl">[docs]</a>    <span class="k">def</span> <span class="nf">merge_dim_from_xl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpath</span><span class="p">,</span> <span class="n">ws_name</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">new_dims</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add dimension based on an table from an Excel file. If you have a chart of accounts you could add the account number</span>
<span class="sd">        to the Line Item if you have it.</span>

<span class="sd">        :param base_dim: Existing dimension in the index on which to merge the new dimension</span>
<span class="sd">        :param new_dims: Column from the accounts data object table to add to the dataframe</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;</span>
<span class="sd">        :return: data_object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dim_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">ws_name</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">new_dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_dims</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_dims</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">new_dims</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;function_result&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">new_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_dim</span><span class="p">)</span>
            <span class="n">dim_df</span> <span class="o">=</span> <span class="n">dim_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">new_dims</span><span class="p">]</span>
            <span class="n">dim_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">base_dim</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="n">dfi</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_df</span><span class="p">,</span> <span class="n">base_dim</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span></div>

<div class="viewcode-block" id="fpa.reorder_dimensions"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.reorder_dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">reorder_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_order</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the order of the dimensions of the index.</span>

<span class="sd">        :param new_order: List input i.e. [&#39;Department&#39;, &#39;Region&#39;, &#39;Data_Block&#39;, &#39;Line Item&#39;]</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;, &#39;variance&#39;</span>
<span class="sd">        :return: data_obj</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">(</span><span class="n">new_order</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">(</span><span class="n">new_order</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;function_result&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">(</span><span class="n">new_order</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">(</span><span class="n">new_order</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">(</span><span class="n">new_order</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">reorder_levels</span><span class="p">(</span><span class="n">new_order</span><span class="p">)</span></div>

<div class="viewcode-block" id="fpa.combine_dimensions"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.combine_dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">combine_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">combine_order</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">s0</span> <span class="o">=</span> <span class="n">dfi</span><span class="p">[</span><span class="n">combine_order</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">combine_order</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">s0</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">dfi</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">item</span><span class="p">])</span>
            <span class="n">dfi</span><span class="p">[</span><span class="n">combine_order</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">s0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">dfi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">dfi</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">s0</span> <span class="o">=</span> <span class="n">dfi</span><span class="p">[</span><span class="n">combine_order</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">combine_order</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">s0</span> <span class="o">=</span> <span class="n">s0</span><span class="o">.</span><span class="n">combine_first</span><span class="p">(</span><span class="n">dfi</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">item</span><span class="p">])</span>
            <span class="n">dfi</span><span class="p">[</span><span class="n">combine_order</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">s0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">dfi</span><span class="p">)</span></div>

<div class="viewcode-block" id="fpa.rename_dimensions"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.rename_dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">rename_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim_list</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Give new names to one or all of the dimension names.  I.e. if dimensions are [&#39;Department&#39;, &#39;Region&#39;, &#39;Data_Block&#39;]</span>
<span class="sd">        it can be changed to [&#39;Department&#39;, &#39;Geography&#39;, &#39;Data_Block&#39;]</span>
<span class="sd">        :param dim_list: List of all the dimension names with the new names included</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;, &#39;variance&#39;</span>
<span class="sd">        :return: data object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">dim_list</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">dim_list</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">dim_list</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">dim_list</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">dim_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">dim_list</span></div>

<div class="viewcode-block" id="fpa.rename_dim_item"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.rename_dim_item">[docs]</a>    <span class="k">def</span> <span class="nf">rename_dim_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Give a new name to an existing name in a dimension.  I.e. if &#39;USA&quot; is to be changed to &#39;North America&#39;</span>

<span class="sd">        :param dim: String value of which dimension contains the item you want to change.  I.e. &#39;Region&#39;</span>
<span class="sd">        :param old: String value of the item to be changed.  I.e. &#39;USA&#39;</span>
<span class="sd">        :param new: String value of the new name of the item.  I.e. &#39;North America&#39;</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;, &#39;variance&#39;</span>
<span class="sd">        :return: data object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;accounts&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;dim_set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="s1">&#39;dim_set&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;function_result&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="fpa.dim_to_date"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.dim_to_date">[docs]</a>    <span class="k">def</span> <span class="nf">dim_to_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to change a dimension or column from object to datetime.</span>

<span class="sd">        :param dim: String value of which dimension contains the item you want to change.  I.e. &#39;Region&#39;</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;, &#39;variance&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;accounts&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;function_result&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;nval&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="fpa.reorder_index_dim"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.reorder_index_dim">[docs]</a>    <span class="k">def</span> <span class="nf">reorder_index_dim</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">new_order</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis_target</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the order of the item within an index.  I.e. if existing the Line Item dimension has an existing order of</span>
<span class="sd">        [&#39;Office Supplies&#39;, &#39;Rent&#39;, &#39;Payroll&#39;], change it to [&#39;Payroll&#39;, &#39;Rent&#39;, &#39;Office Supplies&#39;].</span>

<span class="sd">        :param new_order: List values of the new order.  Should contain all the values.</span>
<span class="sd">        I.e. [&#39;Payroll&#39;, &#39;Rent&#39;, &#39;Office Supplies&#39;]</span>
<span class="sd">        :param dim: Dimension to be reordered</span>
<span class="sd">        :param axis_target: Index or the columns.  I.e. &#39;index&#39; or &#39;columns&#39;</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;, &#39;variance&#39;</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">index_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item_no</span><span class="p">)</span>
            <span class="n">new_order</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item_no</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
                <span class="n">index_items</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis_target</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;nval&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="n">index_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item_no</span><span class="p">)</span>
            <span class="n">new_order</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item_no</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
                <span class="n">index_items</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis_target</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;nval&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">index_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item_no</span><span class="p">)</span>
            <span class="n">new_order</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item_no</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
                <span class="n">index_items</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis_target</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;nval&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;function_result&quot;</span><span class="p">:</span>
            <span class="n">index_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item_no</span><span class="p">)</span>
            <span class="n">new_order</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item_no</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
                <span class="n">index_items</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis_target</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;nval&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="n">index_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item_no</span><span class="p">)</span>
            <span class="n">new_order</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item_no</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
                <span class="n">index_items</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis_target</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;nval&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item_no</span><span class="p">)</span>
            <span class="n">new_order</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item_no</span> <span class="ow">in</span> <span class="n">new_order</span><span class="p">:</span>
                <span class="n">index_items</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">item_no</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
                <span class="n">index_items</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis_target</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;nval&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="fpa.move_dims_to_col"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.move_dims_to_col">[docs]</a>    <span class="k">def</span> <span class="nf">move_dims_to_col</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move a dimension from the index to a column in the data.</span>

<span class="sd">        :param dims: Dimension to drop.  I.e. &#39;Department&#39;</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;, &#39;variance&#39;</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span>
                <span class="n">dims</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="fpa.move_col_to_dims"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.move_col_to_dims">[docs]</a>    <span class="k">def</span> <span class="nf">move_col_to_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move a dimension from the columns in the data to the index.</span>

<span class="sd">        :param dims: Dimension to drop.  I.e. &#39;Department&#39;</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;, &#39;variance&#39;</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="fpa.make_records"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.make_records">[docs]</a>    <span class="k">def</span> <span class="nf">make_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the data object to a records format rather than a table.  Works bes on single level columns.</span>

<span class="sd">        :param data_obj: Which data object you want o effect. Default: &#39;data&#39;.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;,</span>
<span class="sd">         &#39;consolidation&#39;, &#39;function_result&#39;, &#39;variance&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;function_result&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no object&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="fpa.drop_dimension"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.drop_dimension">[docs]</a>    <span class="k">def</span> <span class="nf">drop_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dimension_drop</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a dimension from the index.</span>

<span class="sd">        :param dimension_drop: Dimension to drop.  I.e. &#39;Department&#39;</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;, &#39;variance&#39;</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">dimension_drop</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">dimension_drop</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">dimension_drop</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">dimension_drop</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span>
                <span class="n">dimension_drop</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="n">dimension_drop</span><span class="p">)</span></div>

<div class="viewcode-block" id="fpa.get_block_info"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.get_block_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_block_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the meta information from a data block.  Just plug in the data block number.</span>

<span class="sd">        :param db_id: Interger of the data block. I.e. x.get_block_info(49593949)</span>
<span class="sd">        :return: Meta information for Data_Block.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">meta_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">db_id</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">meta_info</span></div>

<div class="viewcode-block" id="fpa.consol_dimension"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.consol_dimension">[docs]</a>    <span class="k">def</span> <span class="nf">consol_dimension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Consolidates a data object on a certain dimension of the data object.</span>

<span class="sd">        :param dim: Dimension to consolidate on.  I.e. &#39;Department&#39; or &#39;SalesPerson&#39;.</span>
<span class="sd">        :param data_obj: Which data object you want o effect. Default: &#39;data&#39;.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;, &#39;variance&#39;</span>
<span class="sd">        :return: self.consolidation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;function_result&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span></div>

<div class="viewcode-block" id="fpa.slice_data"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.slice_data">[docs]</a>    <span class="k">def</span> <span class="nf">slice_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">col_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">col_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="n">append_to</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Slice and dice data based on dimensions for the index and ranges or lists for the columns.</span>

<span class="sd">        :param dims: List object (even for one item) of dimensions.  I.e. [&#39;Department&#39;, &#39;Line Item&#39;]</span>
<span class="sd">        :param dim_values: List and nested list object (even for one item) of items on which to slice.</span>
<span class="sd">            I.e. [&#39;Operations&#39;, [&#39;Network Costs&#39;, &#39;Payroll&#39;]]</span>
<span class="sd">        :param col_range: List object of start and end point of range. I.e. [&#39;2022-06-30&#39;, &#39;2022-12-31&#39;] for datetime</span>
<span class="sd">        :param col_list: List object columns. I.e. [&#39;2022-06-30&#39;, &#39;2022-09-30&#39;, &#39;2022-12-31&#39;] for datetime</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Available - &#39;data&#39;, &#39;slice&#39;</span>
<span class="sd">        :param append_to: Add data to existing slice data object.</span>
<span class="sd">        :return: self.slice</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="n">dims</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dims</span><span class="p">]</span>
        <span class="n">dim_values</span> <span class="o">=</span> <span class="n">dim_values</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_values</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_values</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">col_search_dims</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">col_search_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">col_search_dims</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">dim</span>
                <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span>
                <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">dims_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">dims</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">col_search_dims</span><span class="p">]</span>
            <span class="n">col_search_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim_values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">dims_idx</span><span class="p">]</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span> <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col_search_dims</span><span class="p">]</span>
            <span class="n">dim_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dim_values</span> <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col_search_values</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">append_to</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dims</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="ow">or</span> <span class="n">dims</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">slice_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">dims</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dim_values</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dim_values</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
                    <span class="n">dim_values</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">:</span>
                            <span class="n">dim_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dim_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                <span class="n">count_row</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">dim_name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dim_values</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
                    <span class="n">sub_count_row</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">subitem</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                            <span class="n">slice_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sub_count_row</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">subitem</span>
                            <span class="n">sub_count_row</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">slice_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count_row</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>

                <span class="n">iter_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">df_count</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dim_count&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">dm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_matrix</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
                    <span class="n">df_count</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;dim_count&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span>
                <span class="k">for</span> <span class="n">target_col</span> <span class="ow">in</span> <span class="n">df_count</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">target_row</span> <span class="ow">in</span> <span class="n">slice_matrix</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">target_column</span> <span class="o">=</span> <span class="n">slice_matrix</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                        <span class="n">target_dim_item</span> <span class="o">=</span> <span class="n">target_column</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">target_row</span><span class="p">]</span>
                        <span class="n">df_rest_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                        <span class="n">df_rest_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>
                        <span class="n">df_rest</span> <span class="o">=</span> <span class="n">slice_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_rest_list</span><span class="p">]</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">df_rest</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_matrix</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span> <span class="o">*</span> <span class="n">x</span>
                        <span class="n">df_item</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                            <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span>
                        <span class="p">)</span>
                        <span class="n">df_item</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_dim_item</span>
                        <span class="k">for</span> <span class="n">rest_col</span> <span class="ow">in</span> <span class="n">df_rest</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">rest_column</span> <span class="o">=</span> <span class="n">df_rest</span><span class="p">[</span><span class="n">rest_col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                            <span class="n">rest_item_count</span> <span class="o">=</span> <span class="n">df_count</span><span class="p">[</span><span class="n">rest_col</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">rest_multiplier</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_item</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">/</span> <span class="n">rest_item_count</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                            <span class="p">)</span>
                            <span class="n">rest_column_insert</span> <span class="o">=</span> <span class="n">rest_column</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">mlper</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rest_multiplier</span><span class="p">):</span>
                                <span class="n">rest_column_insert</span> <span class="o">=</span> <span class="n">rest_column_insert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">rest_column</span>
                                <span class="p">)</span>
                            <span class="n">rest_column_insert</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df_item</span><span class="o">.</span><span class="n">index</span>
                            <span class="n">df_item</span><span class="p">[</span><span class="n">rest_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">rest_column_insert</span>

                        <span class="n">iter_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">iter_matrix</span><span class="p">,</span> <span class="n">df_item</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
                        <span class="p">)</span>

                <span class="n">iter_matrix</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">iter_matrix</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">iter_matrix</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">slice_terms</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">iter_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
                        <span class="n">single_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span>
                            <span class="n">slice_terms</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">drop_level</span><span class="o">=</span><span class="kc">False</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">item_s</span> <span class="ow">in</span> <span class="n">dim_values</span><span class="p">:</span>
                                <span class="n">single_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item_s</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">,</span> <span class="n">single_slice</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Column Search</span>
            <span class="k">if</span> <span class="n">col_search_dims</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">col_search_values</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="n">col_slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">col_slice_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">col_search_dims</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">col_search_values</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">sub_val</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                                <span class="n">single_slice</span> <span class="o">=</span> <span class="n">col_slice_df</span><span class="p">[</span>
                                    <span class="n">col_slice_df</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="n">sub_val</span>
                                <span class="p">]</span>
                                <span class="n">col_slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">col_slice</span><span class="p">,</span> <span class="n">single_slice</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">single_slice</span> <span class="o">=</span> <span class="n">col_slice_df</span><span class="p">[</span><span class="n">col_slice_df</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="n">val</span><span class="p">]</span>
                            <span class="n">col_slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">col_slice</span><span class="p">,</span> <span class="n">single_slice</span><span class="p">])</span>
                    <span class="n">col_slice_df</span> <span class="o">=</span> <span class="n">col_slice</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">col_slice</span>
            <span class="c1"># Column axis slicing</span>
            <span class="k">if</span> <span class="n">col_range</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">col_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">col_list</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col_list</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span>

        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="n">col_search_dims</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">col_search_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">col_search_dims</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">dim</span>
                <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span>
                <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">dims_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">dims</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">col_search_dims</span><span class="p">]</span>
            <span class="n">col_search_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim_values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">dims_idx</span><span class="p">]</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span> <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col_search_dims</span><span class="p">]</span>
            <span class="n">dim_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dim_values</span> <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col_search_values</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">append_to</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dims</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="ow">or</span> <span class="n">dims</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">slice_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">dims</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dim_values</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dim_values</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
                    <span class="n">dim_values</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">:</span>
                            <span class="n">dim_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dim_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                <span class="n">count_row</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">dim_name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dim_values</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
                    <span class="n">sub_count_row</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">subitem</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                            <span class="n">slice_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sub_count_row</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">subitem</span>
                            <span class="n">sub_count_row</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">slice_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count_row</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>

                <span class="n">iter_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">df_count</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dim_count&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">dm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_matrix</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
                    <span class="n">df_count</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;dim_count&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span>
                <span class="k">for</span> <span class="n">target_col</span> <span class="ow">in</span> <span class="n">df_count</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">target_row</span> <span class="ow">in</span> <span class="n">slice_matrix</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">target_column</span> <span class="o">=</span> <span class="n">slice_matrix</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                        <span class="n">target_dim_item</span> <span class="o">=</span> <span class="n">target_column</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">target_row</span><span class="p">]</span>
                        <span class="n">df_rest_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                        <span class="n">df_rest_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>
                        <span class="n">df_rest</span> <span class="o">=</span> <span class="n">slice_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_rest_list</span><span class="p">]</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">df_rest</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_matrix</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span> <span class="o">*</span> <span class="n">x</span>
                        <span class="n">df_item</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                            <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span>
                        <span class="p">)</span>
                        <span class="n">df_item</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_dim_item</span>
                        <span class="k">for</span> <span class="n">rest_col</span> <span class="ow">in</span> <span class="n">df_rest</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">rest_column</span> <span class="o">=</span> <span class="n">df_rest</span><span class="p">[</span><span class="n">rest_col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                            <span class="n">rest_item_count</span> <span class="o">=</span> <span class="n">df_count</span><span class="p">[</span><span class="n">rest_col</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">rest_multiplier</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_item</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">/</span> <span class="n">rest_item_count</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                            <span class="p">)</span>
                            <span class="n">rest_column_insert</span> <span class="o">=</span> <span class="n">rest_column</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">mlper</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rest_multiplier</span><span class="p">):</span>
                                <span class="n">rest_column_insert</span> <span class="o">=</span> <span class="n">rest_column_insert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">rest_column</span>
                                <span class="p">)</span>
                            <span class="n">rest_column_insert</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df_item</span><span class="o">.</span><span class="n">index</span>
                            <span class="n">df_item</span><span class="p">[</span><span class="n">rest_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">rest_column_insert</span>

                        <span class="n">iter_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">iter_matrix</span><span class="p">,</span> <span class="n">df_item</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
                        <span class="p">)</span>

                <span class="n">iter_matrix</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">iter_matrix</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">iter_matrix</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">slice_terms</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">iter_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
                        <span class="n">single_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span>
                            <span class="n">slice_terms</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">drop_level</span><span class="o">=</span><span class="kc">False</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">item_s</span> <span class="ow">in</span> <span class="n">dim_values</span><span class="p">:</span>
                                <span class="n">single_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item_s</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">,</span> <span class="n">single_slice</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Column Search</span>
            <span class="k">if</span> <span class="n">col_search_dims</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">col_search_values</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="n">col_slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">col_slice_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">col_search_dims</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">col_search_values</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">sub_val</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                                <span class="n">single_slice</span> <span class="o">=</span> <span class="n">col_slice_df</span><span class="p">[</span>
                                    <span class="n">col_slice_df</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="n">sub_val</span>
                                <span class="p">]</span>
                                <span class="n">col_slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">col_slice</span><span class="p">,</span> <span class="n">single_slice</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">single_slice</span> <span class="o">=</span> <span class="n">col_slice_df</span><span class="p">[</span><span class="n">col_slice_df</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="n">val</span><span class="p">]</span>
                            <span class="n">col_slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">col_slice</span><span class="p">,</span> <span class="n">single_slice</span><span class="p">])</span>
                    <span class="n">col_slice_df</span> <span class="o">=</span> <span class="n">col_slice</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">col_slice</span>
            <span class="c1"># Column axis slicing</span>
            <span class="k">if</span> <span class="n">col_range</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">col_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">col_list</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col_list</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span>


        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">df_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="n">col_search_dims</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">col_search_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">col_search_dims</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">dim</span>
                <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span>
                <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_slice</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">dims_idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">dims</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">col_search_dims</span><span class="p">]</span>
            <span class="n">col_search_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim_values</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">dims_idx</span><span class="p">]</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span> <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col_search_dims</span><span class="p">]</span>
            <span class="n">dim_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dim_values</span> <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col_search_values</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">append_to</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dims</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="ow">or</span> <span class="n">dims</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">slice_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">dims</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dim_values</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dim_values</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
                    <span class="n">dim_values</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_slice</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">:</span>
                            <span class="n">dim_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dim_values</span> <span class="o">=</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                <span class="n">count_row</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">dim_name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dim_values</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
                    <span class="n">sub_count_row</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">subitem</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                            <span class="n">slice_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sub_count_row</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">subitem</span>
                            <span class="n">sub_count_row</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">slice_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count_row</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>

                <span class="n">iter_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">df_count</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dim_count&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">dm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_matrix</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
                    <span class="n">df_count</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;dim_count&quot;</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">dm</span>
                <span class="k">for</span> <span class="n">target_col</span> <span class="ow">in</span> <span class="n">df_count</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">target_row</span> <span class="ow">in</span> <span class="n">slice_matrix</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">target_column</span> <span class="o">=</span> <span class="n">slice_matrix</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                        <span class="n">target_dim_item</span> <span class="o">=</span> <span class="n">target_column</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">target_row</span><span class="p">]</span>
                        <span class="n">df_rest_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                        <span class="n">df_rest_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target_col</span><span class="p">)</span>
                        <span class="n">df_rest</span> <span class="o">=</span> <span class="n">slice_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_rest_list</span><span class="p">]</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">df_rest</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slice_matrix</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span> <span class="o">*</span> <span class="n">x</span>
                        <span class="n">df_item</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                            <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">slice_matrix</span><span class="o">.</span><span class="n">columns</span>
                        <span class="p">)</span>
                        <span class="n">df_item</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_dim_item</span>
                        <span class="k">for</span> <span class="n">rest_col</span> <span class="ow">in</span> <span class="n">df_rest</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">rest_column</span> <span class="o">=</span> <span class="n">df_rest</span><span class="p">[</span><span class="n">rest_col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
                            <span class="n">rest_item_count</span> <span class="o">=</span> <span class="n">df_count</span><span class="p">[</span><span class="n">rest_col</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">rest_multiplier</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_item</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">/</span> <span class="n">rest_item_count</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                            <span class="p">)</span>
                            <span class="n">rest_column_insert</span> <span class="o">=</span> <span class="n">rest_column</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                            <span class="k">for</span> <span class="n">mlper</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rest_multiplier</span><span class="p">):</span>
                                <span class="n">rest_column_insert</span> <span class="o">=</span> <span class="n">rest_column_insert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">rest_column</span>
                                <span class="p">)</span>
                            <span class="n">rest_column_insert</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df_item</span><span class="o">.</span><span class="n">index</span>
                            <span class="n">df_item</span><span class="p">[</span><span class="n">rest_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">rest_column_insert</span>

                        <span class="n">iter_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">iter_matrix</span><span class="p">,</span> <span class="n">df_item</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
                        <span class="p">)</span>

                <span class="n">iter_matrix</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">iter_matrix</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">iter_matrix</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                    <span class="n">slice_terms</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">iter_matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_slice</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
                        <span class="n">single_slice</span> <span class="o">=</span> <span class="n">df_slice</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span>
                            <span class="n">slice_terms</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span> <span class="n">drop_level</span><span class="o">=</span><span class="kc">False</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">item_s</span> <span class="ow">in</span> <span class="n">dim_values</span><span class="p">:</span>
                                <span class="n">single_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">item_s</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">,</span> <span class="n">single_slice</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Column Search</span>
            <span class="k">if</span> <span class="n">col_search_dims</span> <span class="o">!=</span> <span class="p">[]</span> <span class="ow">and</span> <span class="n">col_search_values</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="n">col_slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                <span class="n">col_slice_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">col_search_dims</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">col_search_values</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">sub_val</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                                <span class="n">single_slice</span> <span class="o">=</span> <span class="n">col_slice_df</span><span class="p">[</span>
                                    <span class="n">col_slice_df</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="n">sub_val</span>
                                <span class="p">]</span>
                                <span class="n">col_slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">col_slice</span><span class="p">,</span> <span class="n">single_slice</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">single_slice</span> <span class="o">=</span> <span class="n">col_slice_df</span><span class="p">[</span><span class="n">col_slice_df</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="n">val</span><span class="p">]</span>
                            <span class="n">col_slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">col_slice</span><span class="p">,</span> <span class="n">single_slice</span><span class="p">])</span>
                    <span class="n">col_slice_df</span> <span class="o">=</span> <span class="n">col_slice</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">col_slice</span>
            <span class="c1"># Column axis slicing</span>
            <span class="k">if</span> <span class="n">col_range</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">col_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">col_list</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">col_list</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span></div>

<div class="viewcode-block" id="fpa.column_slice"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.column_slice">[docs]</a>    <span class="k">def</span> <span class="nf">column_slice</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dim_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">col_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">col_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="n">append_to</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">dims</span> <span class="o">=</span> <span class="n">dims</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dims</span><span class="p">]</span>
        <span class="n">dim_values</span> <span class="o">=</span> <span class="n">dim_values</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_values</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">dim_values</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">append_to</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dims</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="fpa.time_slice"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.time_slice">[docs]</a>    <span class="k">def</span> <span class="nf">time_slice</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">start_dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end_dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">idx_period</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">col_period</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">original_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">slice_order</span> <span class="o">=</span> <span class="n">original_order</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">slice_order</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
                <span class="n">slice_order</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">slice_order</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">end_dt</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">drop_level</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">original_order</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">idx_period</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">idx_period</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">col_period</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">col_period</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">original_order</span><span class="p">,</span> <span class="s2">&quot;slice&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">original_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dim</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">slice_order</span> <span class="o">=</span> <span class="n">original_order</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">slice_order</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
                <span class="n">slice_order</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">slice_order</span><span class="p">,</span> <span class="s2">&quot;slice&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span>
                    <span class="nb">slice</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">end_dt</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">drop_level</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">idx_period</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">idx_period</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">col_period</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">col_period</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">original_order</span><span class="p">,</span> <span class="s2">&quot;slice&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span></div>

<div class="viewcode-block" id="fpa.keyword_slice"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.keyword_slice">[docs]</a>    <span class="k">def</span> <span class="nf">keyword_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keywords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">append_to</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Slice data based on string fragment.  Function will search the index &amp; data and return any rows with the</span>
<span class="sd">        search string.</span>

<span class="sd">        :param keywords: String object of which to search.  I.e. &#39;Rent&#39;, &#39;LLC&#39;, &#39;Smith&#39;</span>
<span class="sd">        :param dims: String or list object of specific dimensions to search. Blank will search all dimensions &amp; data.</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Default: &#39;data&#39;. Available - &#39;data&#39;, &#39;slice&#39;</span>
<span class="sd">        :param append_to: True indicates new search will be appended to existing search results.  False means it won&#39;t.</span>
<span class="sd">        :return: self.slice</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="n">keywords</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">keywords</span>
            <span class="n">word_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">original_index_order</span> <span class="o">=</span> <span class="n">word_slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dims</span> <span class="o">=</span> <span class="n">original_index_order</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">word_slice</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="n">original_index_order</span><span class="p">:</span>
                <span class="n">word_slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;TEMP_INDEX&#39;</span>
            <span class="n">keyword_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">word_slice</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
                    <span class="n">keyword_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">keyword_result</span> <span class="o">=</span> <span class="n">word_slice</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">word_slice</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                        <span class="p">]</span>
                        <span class="n">word_slice</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">keyword_result</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="n">keyword_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">keyword_matrix</span><span class="p">,</span> <span class="n">keyword_result</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="n">keywords</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">keywords</span>
            <span class="n">word_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">original_index_order</span> <span class="o">=</span> <span class="n">word_slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dims</span> <span class="o">=</span> <span class="n">original_index_order</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">word_slice</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="n">original_index_order</span><span class="p">:</span>
                <span class="n">word_slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;TEMP_INDEX&#39;</span>
            <span class="n">keyword_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">word_slice</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
                    <span class="n">keyword_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">keyword_result</span> <span class="o">=</span> <span class="n">word_slice</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">word_slice</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
                        <span class="p">]</span>
                        <span class="n">word_slice</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">keyword_result</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="n">keyword_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">keyword_matrix</span><span class="p">,</span> <span class="n">keyword_result</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">keyword_matrix</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;TEMP_INDEX&#39;</span><span class="p">:</span>
            <span class="n">keyword_matrix</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keyword_matrix</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">append_to</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">,</span> <span class="n">keyword_matrix</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span> <span class="o">=</span> <span class="n">keyword_matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">original_index_order</span><span class="p">,</span> <span class="s2">&quot;slice&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span></div>

<div class="viewcode-block" id="fpa.keyword_replace"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.keyword_replace">[docs]</a>    <span class="k">def</span> <span class="nf">keyword_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_words</span><span class="p">,</span> <span class="n">replace_words</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace a word or words in the index.  For example, if you wanted to replace [&#39;Payroll&#39;, &#39;East&#39;] with</span>
<span class="sd">        [&#39;Salaries &amp; Wages&#39;, &#39;Northeast&#39;].</span>

<span class="sd">        :param target_words: String or list of word(s) to be replace. I.e. &#39;Software&#39; or [&#39;Payroll&#39;, &#39;East&#39;].</span>
<span class="sd">        :param replace_words: String or list of word(s) to insert. I.e. &#39;3rd Party Code&#39; or [&#39;Salaries &amp; Wages&#39;, &#39;Northeast&#39;].</span>
<span class="sd">        :param dims: String or list of specific dimensions to effect.</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Default: &#39;data&#39;. Available - &#39;data&#39;, &#39;slice&#39;</span>
<span class="sd">        :return: data_obj</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">target_words</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="n">target_words</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_words</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">target_words</span>
            <span class="p">)</span>
            <span class="n">replace_words</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="n">replace_words</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">replace_words</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">replace_words</span>
            <span class="p">)</span>
            <span class="n">original_index_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dims</span> <span class="o">=</span> <span class="n">original_index_order</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">dims</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">rword</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">target_words</span><span class="p">,</span> <span class="n">replace_words</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">rword</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">original_index_order</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">target_words</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="n">target_words</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_words</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">target_words</span>
            <span class="p">)</span>
            <span class="n">replace_words</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="n">replace_words</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">replace_words</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">replace_words</span>
            <span class="p">)</span>
            <span class="n">original_index_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>
            <span class="k">if</span> <span class="n">dims</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dims</span> <span class="o">=</span> <span class="n">original_index_order</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">dims</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">rword</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">target_words</span><span class="p">,</span> <span class="n">replace_words</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">rword</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dims</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">original_index_order</span><span class="p">,</span> <span class="s2">&quot;slice&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span></div>

<div class="viewcode-block" id="fpa.make_records_for_pivot"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.make_records_for_pivot">[docs]</a>    <span class="k">def</span> <span class="nf">make_records_for_pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the data object to a records format so it can be pasted into Excel in a</span>
<span class="sd">        pivot table friendly format.  Only works if the column index is a single level.</span>

<span class="sd">        :param data_obj: Which data object you want o effect. Default: &#39;data&#39;.  Available - &#39;block&#39;, &#39;data&#39;, &#39;slice&#39;, &#39;consolidation&#39;,</span>
<span class="sd">         &#39;function_result&#39;, &#39;variance&#39;</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">df_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
            <span class="n">df_records</span><span class="o">.</span><span class="n">to_clipboard</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">df_records</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">df_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
            <span class="n">df_records</span><span class="o">.</span><span class="n">to_clipboard</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">df_records</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="n">df_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
            <span class="n">df_records</span><span class="o">.</span><span class="n">to_clipboard</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">df_records</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span>
            <span class="n">df_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
            <span class="n">df_records</span><span class="o">.</span><span class="n">to_clipboard</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">df_records</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="n">df_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
            <span class="n">df_records</span><span class="o">.</span><span class="n">to_clipboard</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">df_records</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;function_result&quot;</span><span class="p">:</span>
            <span class="n">df_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
            <span class="n">df_records</span><span class="o">.</span><span class="n">to_clipboard</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">df_records</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no object&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="fpa.save_project"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.save_project">[docs]</a>    <span class="k">def</span> <span class="nf">save_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prj_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a project as either a directory with pickle files or as a json object.</span>

<span class="sd">        :param prj_name: String object for name of the project.  Will make a directory in path_name if it doesn&#39;t exist.</span>
<span class="sd">        :param path_name: Path to directory or a full file path for json.  I.e. for json file</span>
<span class="sd">         &#39;C:/Budgets/Budgets v1.json&#39; or &#39;C:/Budgets/&#39; for normal save</span>
<span class="sd">        :return: nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path_name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">path_name</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="n">container</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;data_idx&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;accounts&quot;</span><span class="p">,</span> <span class="s2">&quot;accts_idx&quot;</span><span class="p">],</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Load&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;Load&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;data_idx&quot;</span><span class="p">,</span> <span class="s2">&quot;Load&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span>
                <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span>
            <span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;Load&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;accounts&quot;</span><span class="p">,</span> <span class="s2">&quot;Load&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;accts_idx&quot;</span><span class="p">,</span> <span class="s2">&quot;Load&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span>
                <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span>
            <span class="p">)</span>
            <span class="n">container</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">path_name</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path_name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">path_name</span> <span class="o">=</span> <span class="n">path_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">path_name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                    <span class="n">path_name</span> <span class="o">=</span> <span class="n">path_name</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span>
            <span class="k">if</span> <span class="n">path_name</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">path_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
                <span class="n">path_name</span> <span class="o">=</span> <span class="n">path_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">prj_name</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">prj_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path_name</span> <span class="o">+</span> <span class="n">prj_name</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_name</span> <span class="o">+</span> <span class="n">prj_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">path_name</span> <span class="o">+</span> <span class="n">prj_name</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">prj_name</span> <span class="o">+</span> <span class="s2">&quot; - data.pkl&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span>
                <span class="n">path_name</span> <span class="o">+</span> <span class="n">prj_name</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">prj_name</span> <span class="o">+</span> <span class="s2">&quot; - meta_block.pkl&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span>
                <span class="n">path_name</span> <span class="o">+</span> <span class="n">prj_name</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">prj_name</span> <span class="o">+</span> <span class="s2">&quot; - accounts.pkl&quot;</span>
            <span class="p">)</span></div>
        <span class="c1"># TODO: Add and test compression. SAVE &amp; LOAD</span>

<div class="viewcode-block" id="fpa.load_project"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.load_project">[docs]</a>    <span class="k">def</span> <span class="nf">load_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Imports the project by filling the &#39;data&#39;, &#39;meta_block&#39; and &#39;accounts&#39; data objects.</span>

<span class="sd">        :param path_name: Path to directory for normal save or to the json file. I.e. for json file</span>
<span class="sd">         &#39;C:/Budgets/Budgets v1.json&#39; or &#39;C:/Budgets/&#39; for normal load.</span>
<span class="sd">        :return: project</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path_name</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
            <span class="n">load_container</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">path_name</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">load_container</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="n">data_idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span>
                <span class="n">load_container</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="s2">&quot;data_idx&quot;</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">data_idx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span>
                <span class="n">load_container</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">convert_axes</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span>
                <span class="n">load_container</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="s2">&quot;accounts&quot;</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span>
            <span class="p">)</span>
            <span class="n">accounts_idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span>
                <span class="n">load_container</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="s2">&quot;accts_idx&quot;</span><span class="p">],</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">data_idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path_name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">path_name</span> <span class="o">=</span> <span class="n">path_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">):</span>
                <span class="n">path_name</span> <span class="o">=</span> <span class="n">path_name</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
            <span class="n">file_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_name</span><span class="p">))</span>
            <span class="n">f_name</span> <span class="o">=</span> <span class="n">file_list</span><span class="p">[</span><span class="n">file_list</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;- data.pkl&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">path_name</span> <span class="o">+</span> <span class="n">f_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">f_name</span> <span class="o">=</span> <span class="n">file_list</span><span class="p">[</span><span class="n">file_list</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;- meta_block.pkl&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">meta_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">path_name</span> <span class="o">+</span> <span class="n">f_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta_block</span> <span class="o">=</span> <span class="n">meta_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">f_name</span> <span class="o">=</span> <span class="n">file_list</span><span class="p">[</span><span class="n">file_list</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;- accounts.pkl&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">accounts_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">path_name</span> <span class="o">+</span> <span class="n">f_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="n">accounts_df</span></div>

<div class="viewcode-block" id="fpa.slice_to_project"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.slice_to_project">[docs]</a>    <span class="k">def</span> <span class="nf">slice_to_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="fpa.make_pivot_table"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.make_pivot_table">[docs]</a>    <span class="k">def</span> <span class="nf">make_pivot_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">value_col</span><span class="p">,</span>
        <span class="n">index_names</span><span class="p">,</span>
        <span class="n">col_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="n">function</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span>
        <span class="n">totals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">total_names</span><span class="o">=</span><span class="s2">&quot;Total&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
                <span class="n">df</span><span class="p">,</span>
                <span class="n">value_col</span><span class="p">,</span>
                <span class="n">index_names</span><span class="p">,</span>
                <span class="n">col_names</span><span class="p">,</span>
                <span class="n">aggfunc</span><span class="o">=</span><span class="n">function</span><span class="p">,</span>
                <span class="n">margins</span><span class="o">=</span><span class="n">totals</span><span class="p">,</span>
                <span class="n">margins_name</span><span class="o">=</span><span class="n">total_names</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span>

        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
                <span class="n">df</span><span class="p">,</span>
                <span class="n">value_col</span><span class="p">,</span>
                <span class="n">index_names</span><span class="p">,</span>
                <span class="n">col_names</span><span class="p">,</span>
                <span class="n">aggfunc</span><span class="o">=</span><span class="n">function</span><span class="p">,</span>
                <span class="n">margins</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">margins_name</span><span class="o">=</span><span class="n">total_names</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span>

        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;consolidation&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consolidation</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
                <span class="n">df</span><span class="p">,</span>
                <span class="n">value_col</span><span class="p">,</span>
                <span class="n">index_names</span><span class="p">,</span>
                <span class="n">col_names</span><span class="p">,</span>
                <span class="n">aggfunc</span><span class="o">=</span><span class="n">function</span><span class="p">,</span>
                <span class="n">margins</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">margins_name</span><span class="o">=</span><span class="n">total_names</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span></div>

<div class="viewcode-block" id="fpa.variance_analysis"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.variance_analysis">[docs]</a>    <span class="k">def</span> <span class="nf">variance_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim1</span><span class="p">,</span> <span class="n">dim2</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns and difference and percent difference analysis based on two items with in a dimension. I.e.</span>
<span class="sd">        x.variance_analysis(&#39;Type&#39;, &#39;Actual&#39;, &#39;Budget&#39;) will produce the &#39;variance&#39; data object with amount and</span>
<span class="sd">        percent differences.</span>

<span class="sd">        :param dim_name: String object of the name of dimension.  I.e. &#39;Type&#39; or &#39;Region&#39;.</span>
<span class="sd">        :param dim1: String object of the name of dimension item for first part of calculation.  I.e. &#39;Actual&#39; or &#39;North&#39;.</span>
<span class="sd">        :param dim2: String object of the name of dimension item for comparison.  I.e. &#39;Budget&#39; or &#39;South&#39;.</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Default: &#39;data&#39;. Available - &#39;data&#39;, &#39;slice&#39;</span>
<span class="sd">        :return: self.variance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">df1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">dim1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim_name</span><span class="p">)</span>
            <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">dim2</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim_name</span><span class="p">)</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">df1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">dim1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim_name</span><span class="p">)</span>
            <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">dim2</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim_name</span><span class="p">)</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
        <span class="n">amt_var</span> <span class="o">=</span> <span class="n">df1</span> <span class="o">-</span> <span class="n">df2</span>
        <span class="n">pct_var</span> <span class="o">=</span> <span class="n">df1</span> <span class="o">/</span> <span class="n">df2</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">amt_var</span><span class="p">,</span> <span class="n">pct_var</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Amount&quot;</span><span class="p">,</span> <span class="s2">&quot;Percent&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span></div>

    <span class="c1"># TODO: refine - percent?</span>

<div class="viewcode-block" id="fpa.multiply_dim"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.multiply_dim">[docs]</a>    <span class="k">def</span> <span class="nf">multiply_dim</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">calc_name</span><span class="o">=</span><span class="s2">&quot;New Item&quot;</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;slice&quot;</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiply two or more dimension items.  For example, multiply units x price x discount with</span>
<span class="sd">        x.multiply_dim(&#39;Basis&#39;, [&#39;Units&#39;, &#39;Price&#39;, &#39;Discount&#39;]</span>
<span class="sd">        :param dim_name: String object of dimension name.  I.e. &#39;Basis&#39;.</span>
<span class="sd">        :param dim_vals: List object of dimension items to multiply.  I.e. [&#39;Units&#39;, &#39;Price&#39;, &#39;Discount&#39;]</span>
<span class="sd">        :param calc_name: String object of new dimension item name.  I.e. &#39;Total_Revenue&#39;</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Default: &#39;slice&#39;. Available - &#39;data&#39;, &#39;slice&#39;</span>
<span class="sd">        :return: self.function_result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dim_vals</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dim_vals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim_name</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dim_vals</span><span class="p">:</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim_name</span><span class="p">)</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
                <span class="n">df1_idx</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">index</span>
                <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">*</span> <span class="n">df1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df1_idx</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dim_vals</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dim_vals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim_name</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dim_vals</span><span class="p">:</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim_name</span><span class="p">)</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
                <span class="n">df1_idx</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">index</span>
                <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">*</span> <span class="n">df1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df1_idx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">=</span> <span class="n">df</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_name</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">dim_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">calc_name</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">calc_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">calc_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">(</span><span class="n">dim_name</span><span class="p">,</span> <span class="n">calc_name</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;function_result&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_xl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span></div>

<div class="viewcode-block" id="fpa.sum_dim"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.sum_dim">[docs]</a>    <span class="k">def</span> <span class="nf">sum_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">calc_name</span><span class="o">=</span><span class="s2">&quot;New Item&quot;</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;slice&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add two or more dimension items.  For example, &#39;Rent&#39; + &#39;Office Supplies&#39; with</span>
<span class="sd">        FPA_OBJECT.sum_dim(&#39;Line Item&#39;, [&#39;Rent&#39;, &#39;Office Supplies&#39;]</span>

<span class="sd">        :param dim_name: String object of dimension name.  I.e. &#39;Line Item&#39;.</span>
<span class="sd">        :param dim_vals: List object of dimension items to multiply.  I.e. [&#39;Rent&#39;, &#39;Office Supplies&#39;]</span>
<span class="sd">        :param calc_name: String object of new dimension item name.  I.e. &#39;Office Expense&#39;</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Default: &#39;slice&#39;. Available - &#39;data&#39;, &#39;slice&#39;</span>
<span class="sd">        :return: self.function_result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">dim_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim_vals</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dim_vals</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dim_vals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim_name</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dim_vals</span><span class="p">:</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim_name</span><span class="p">)</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
                <span class="n">df1_idx</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">index</span>
                <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">+</span> <span class="n">df1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df1_idx</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">dim_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim_vals</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dim_vals</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dim_vals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim_name</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dim_vals</span><span class="p">:</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim_name</span><span class="p">)</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
                <span class="n">df1_idx</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">index</span>
                <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">+</span> <span class="n">df1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df1_idx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">=</span> <span class="n">df</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_name</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">dim_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">calc_name</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">calc_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">calc_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">(</span><span class="n">dim_name</span><span class="p">,</span> <span class="n">calc_name</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;function_result&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_xl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span></div>

<div class="viewcode-block" id="fpa.subtract_dim"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.subtract_dim">[docs]</a>    <span class="k">def</span> <span class="nf">subtract_dim</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dim_name</span><span class="p">,</span> <span class="n">dim_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">calc_name</span><span class="o">=</span><span class="s2">&quot;New Item&quot;</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;slice&quot;</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subtract two or more dimension items.  For example, &#39;Total_Revenue&#39; - &#39;COGS&#39; with</span>
<span class="sd">        FPA_OBJECT.subtract_dim(&#39;IS_Category&#39;, [&#39;Total_Revenue&#39;, &#39;COGS&#39;]</span>

<span class="sd">        :param dim_name: String object of dimension name.  I.e. &#39;IS_Category&#39;.</span>
<span class="sd">        :param dim_vals: List object of dimension items to multiply.  I.e. [&#39;Total_Revenue&#39;, &#39;COGS&#39;]</span>
<span class="sd">        :param calc_name: String object of new dimension item name.  I.e. &#39;Gross Profit&#39;</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Default: &#39;slice&#39;. Available - &#39;data&#39;, &#39;slice&#39;</span>
<span class="sd">        :return: self.function_result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">dim_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim_vals</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dim_vals</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dim_vals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim_name</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dim_vals</span><span class="p">:</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim_name</span><span class="p">)</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
                <span class="n">df1_idx</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">index</span>
                <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">-</span> <span class="n">df1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df1_idx</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_vals</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">dim_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim_vals</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dim_vals</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dim_vals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">dim_name</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dim_vals</span><span class="p">:</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">dim_name</span><span class="p">)</span>
                <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">droplevel</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
                <span class="n">df1_idx</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">index</span>
                <span class="n">df1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">-</span> <span class="n">df1</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df1_idx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">=</span> <span class="n">df</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_name</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">dim_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">calc_name</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">calc_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">calc_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">(</span><span class="n">dim_name</span><span class="p">,</span> <span class="n">calc_name</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;function_result&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_xl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span></div>

<div class="viewcode-block" id="fpa.remove_duplicates"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.remove_duplicates">[docs]</a>    <span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">based_on</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_item</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes repetitive records based on the index.  Can be filtered down by dimensions.</span>

<span class="sd">        :param based_on: String or list object of dimensions to be used.  If blank it will all dimensions.</span>
<span class="sd">        :param keep_item: String object of which records to keep. I.e. either &#39;last&#39; or &#39;first&#39;.</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Default: &#39;data&#39;. Available - &#39;data&#39;, &#39;block&#39;, &#39;slice&#39;</span>
<span class="sd">        :return: data object without duplicate records</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="n">index_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="n">lx</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">lx</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">based_on</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">based_on</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">based_on</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">based_on</span> <span class="o">=</span> <span class="p">[</span><span class="n">based_on</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">based_on</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="n">keep_item</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">index_order</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;block&quot;</span><span class="p">:</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="n">index_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="n">lx</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">lx</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">based_on</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">based_on</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">based_on</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">based_on</span> <span class="o">=</span> <span class="p">[</span><span class="n">based_on</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">based_on</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="n">keep_item</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">index_order</span><span class="p">,</span> <span class="s2">&quot;block&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span>
        <span class="k">elif</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;slice&quot;</span><span class="p">:</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="n">index_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="n">lx</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">lx</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">based_on</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">based_on</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">based_on</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">based_on</span> <span class="o">=</span> <span class="p">[</span><span class="n">based_on</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">based_on</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="n">keep_item</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">index_order</span><span class="p">,</span> <span class="s2">&quot;block&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice</span></div>

<div class="viewcode-block" id="fpa.get_duplicates"><a class="viewcode-back" href="../pyfpa.html#pyfpa.fpa.get_duplicates">[docs]</a>    <span class="k">def</span> <span class="nf">get_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">based_on</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_obj</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves repetitive records based on the index.  Can be filtered down by dimensions.</span>

<span class="sd">        :param based_on: String or list object of dimensions to be used.  If blank it will all dimensions.</span>
<span class="sd">        :param data_obj: Which data object you want o effect.  Default: &#39;data&#39;. Available - &#39;data&#39;</span>
<span class="sd">        :return: self.function_result</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data_obj</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">lx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="n">index_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
            <span class="n">lx</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Data_Block&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">lx</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">based_on</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">based_on</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">based_on</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">based_on</span> <span class="o">=</span> <span class="p">[</span><span class="n">based_on</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                    <span class="n">z</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">based_on</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;No objects to concatenate&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No duplicates.&quot;</span><span class="p">)</span>
                    <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reorder_dimensions</span><span class="p">(</span><span class="n">index_order</span><span class="p">,</span> <span class="s2">&quot;function_result&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_result</span></div>

    <span class="k">def</span> <span class="nf">_align_indicies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">names</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">w</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="s2">&quot;na&quot;</span><span class="p">],</span> <span class="n">data_obj</span><span class="o">=</span><span class="s1">&#39;block&#39;</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="ow">in</span> <span class="n">y</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">w</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_dimensions</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="s2">&quot;na&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span></div>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Erik Warren.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>